<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>04_milo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./00_data.html">
 <span class="menu-text">00_Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./01_clustering.html">
 <span class="menu-text">01_Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02_differential_analysis.html">
 <span class="menu-text">02_Differential_analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./03_comparsion_milo.html" aria-current="page">
 <span class="menu-text">04_milo</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link active" data-scroll-target="#loading-packages">Loading packages</a></li>
  <li><a href="#clustering-by-type" id="toc-clustering-by-type" class="nav-link" data-scroll-target="#clustering-by-type">Clustering by type</a></li>
  <li><a href="#da-analysis" id="toc-da-analysis" class="nav-link" data-scroll-target="#da-analysis">DA analysis</a></li>
  <li><a href="#milo" id="toc-milo" class="nav-link" data-scroll-target="#milo">Milo</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">04_milo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">Loading packages</h2>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-2_4b49de8c1d47b4cd120d38e8b1c65dc4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(miloR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SingleCellExperiment)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scater)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clustering-by-type" class="level2">
<h2 class="anchored" data-anchor-id="clustering-by-type">Clustering by type</h2>
<p>Function to run PCA</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-3_6234546b067fe27c639c796252097619">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>myfeature <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"type"</span>, <span class="st">"state"</span>, <span class="cn">NULL</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>run.PCA <span class="ot">&lt;-</span> <span class="cf">function</span>(feature) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  sce <span class="ot">&lt;-</span> <span class="fu">cluster</span>(sce, <span class="at">features =</span> feature, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xdim =</span> <span class="dv">10</span>, <span class="at">ydim =</span> <span class="dv">10</span>, <span class="at">maxK =</span> <span class="dv">20</span>, <span class="at">seed =</span> <span class="dv">1234</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  sce <span class="ot">&lt;-</span> <span class="fu">runDR</span>(sce, <span class="st">"PCA"</span>, <span class="at">features =</span> feature)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sce.list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(myfeature, run.PCA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>o running FlowSOM clustering...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>o running ConsensusClusterPlus metaclustering...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more
singular values/vectors requested than available</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : You're computing too large a percentage of total singular values, use a
standard svd instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : did not converge--results might be invalid!; try increasing work or
maxit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>o running FlowSOM clustering...
o running ConsensusClusterPlus metaclustering...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more
singular values/vectors requested than available</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : You're computing too large a percentage of total singular values, use a
standard svd instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : did not converge--results might be invalid!; try increasing work or
maxit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>o running FlowSOM clustering...
o running ConsensusClusterPlus metaclustering...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more
singular values/vectors requested than available</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : You're computing too large a percentage of total singular values, use a
standard svd instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth =
TRUE, : did not converge--results might be invalid!; try increasing work or
maxit</code></pre>
</div>
</div>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-4_ca15eb95bb88088488da6ab6977479f8">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>merging_table1 <span class="ot">&lt;-</span> <span class="st">"PBMC8_cluster_merging1.xlsx"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="fu">file.path</span>(url, merging_table1), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">destfile =</span> merging_table1, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>merging_table1 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(merging_table1)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(merging_table1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  original_cluster  new_cluster
1                1 B-cells IgM+
2                2     surface-
3                3     NK cells
4                4  CD8 T-cells
5                5 B-cells IgM-
6                6    monocytes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>merging_table1<span class="sc">$</span>new_cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(merging_table1<span class="sc">$</span>new_cluster, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B-cells IgM+"</span>, <span class="st">"B-cells IgM-"</span>, <span class="st">"CD4 T-cells"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CD8 T-cells"</span>, <span class="st">"DC"</span>, <span class="st">"NK cells"</span>, <span class="st">"monocytes"</span>, <span class="st">"surface-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="da-analysis" class="level2">
<h2 class="anchored" data-anchor-id="da-analysis">DA analysis</h2>
<p>Preparing required variables</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-5_e1db071d4329faa6ad0720fa805cd2a4">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>merging_table1 <span class="ot">&lt;-</span> <span class="st">"PBMC8_cluster_merging1.xlsx"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="fu">file.path</span>(url, merging_table1), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">destfile =</span> merging_table1, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>merging_table1 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(merging_table1)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(merging_table1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  original_cluster  new_cluster
1                1 B-cells IgM+
2                2     surface-
3                3     NK cells
4                4  CD8 T-cells
5                5 B-cells IgM-
6                6    monocytes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>merging_table1<span class="sc">$</span>new_cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(merging_table1<span class="sc">$</span>new_cluster, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B-cells IgM+"</span>, <span class="st">"B-cells IgM-"</span>, <span class="st">"CD4 T-cells"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CD8 T-cells"</span>, <span class="st">"DC"</span>, <span class="st">"NK cells"</span>, <span class="st">"monocytes"</span>, <span class="st">"surface-"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ei <span class="ot">&lt;-</span> <span class="fu">metadata</span>(sce)<span class="sc">$</span>experiment_info</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>(da_formula1 <span class="ot">&lt;-</span> <span class="fu">createFormula</span>(ei, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_fixed =</span> <span class="st">"condition"</span>, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_random =</span> <span class="st">"sample_id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$formula
y ~ condition + (1 | sample_id)
&lt;environment: 0x7fcbfbd05200&gt;

$data
   condition sample_id
1      BCRXL    BCRXL1
2        Ref      Ref1
3      BCRXL    BCRXL2
4        Ref      Ref2
5      BCRXL    BCRXL3
6        Ref      Ref3
7      BCRXL    BCRXL4
8        Ref      Ref4
9      BCRXL    BCRXL5
10       Ref      Ref5
11     BCRXL    BCRXL6
12       Ref      Ref6
13     BCRXL    BCRXL7
14       Ref      Ref7
15     BCRXL    BCRXL8
16       Ref      Ref8

$random_terms
[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(da_formula2 <span class="ot">&lt;-</span> <span class="fu">createFormula</span>(ei, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_fixed =</span> <span class="st">"condition"</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_random =</span> <span class="fu">c</span>(<span class="st">"sample_id"</span>, <span class="st">"patient_id"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$formula
y ~ condition + (1 | sample_id) + (1 | patient_id)
&lt;environment: 0x7fcbfbc632a8&gt;

$data
   condition sample_id patient_id
1      BCRXL    BCRXL1   Patient1
2        Ref      Ref1   Patient1
3      BCRXL    BCRXL2   Patient2
4        Ref      Ref2   Patient2
5      BCRXL    BCRXL3   Patient3
6        Ref      Ref3   Patient3
7      BCRXL    BCRXL4   Patient4
8        Ref      Ref4   Patient4
9      BCRXL    BCRXL5   Patient5
10       Ref      Ref5   Patient5
11     BCRXL    BCRXL6   Patient6
12       Ref      Ref6   Patient6
13     BCRXL    BCRXL7   Patient7
14       Ref      Ref7   Patient7
15     BCRXL    BCRXL8   Patient8
16       Ref      Ref8   Patient8

$random_terms
[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">createContrast</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ei</span>(sce)<span class="sc">$</span>condition)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>group)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(design) <span class="ot">&lt;-</span> <span class="fu">levels</span>(group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run DA analysis function</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-6_a1ea389a25ddbab75cb5e576984c91f1">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sce.list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sce.list, mergeClusters, <span class="at">k =</span> <span class="st">"meta20"</span>, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">table =</span> merging_table1, <span class="at">id =</span> <span class="st">"merging1"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>run.DA <span class="ot">&lt;-</span> <span class="cf">function</span>(sce){</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  da_res <span class="ot">&lt;-</span> <span class="fu">diffcyt</span>(sce, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> da_formula1, <span class="at">contrast =</span> contrast, <span class="at">design =</span> design,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">analysis_type =</span> <span class="st">"DA"</span>, <span class="at">method_DA =</span> <span class="st">"diffcyt-DA-edgeR"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">clustering_to_use =</span> <span class="st">"merging1"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>diffcyt.da_res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sce.list, run.DA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="milo" class="level1">
<h1>Milo</h1>
<p>Preparing traj_design</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-7_86e4a3026c774d763b557324944112c8">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.1.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>prepare.traj_design <span class="ot">&lt;-</span> <span class="cf">function</span>(traj_milo){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  traj_design <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">colData</span>(traj_milo))[,<span class="fu">c</span>(<span class="st">"sample_id"</span>, <span class="st">"condition"</span>)]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  traj_design <span class="ot">&lt;-</span> <span class="fu">distinct</span>(traj_design)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  traj_design<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(<span class="fu">nhoodCounts</span>(traj_milo))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  traj_design<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(traj_design<span class="sc">$</span>sample_id, <span class="dv">1</span>, <span class="fu">str_length</span>(traj_design<span class="sc">$</span>sample_id)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(traj_design) <span class="ot">&lt;-</span> traj_design<span class="sc">$</span>sample_id</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(traj_design)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run milo</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-8_ed3afd0ebf035bce254728dddeb92477">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotUMAP(traj_milo) + plotNhoodGraphDA(traj_milo, da_results, alpha=0.05) +</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  plot_layout(guides="collect")</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plotNhoodGroups(traj_milo, milo_res = da_results, alpha = 0.05) + plot_layout(guides="collect") </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>run.Milo <span class="ot">&lt;-</span> <span class="cf">function</span>(sce, cluster_id){</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  traj_milo <span class="ot">&lt;-</span> <span class="fu">Milo</span>(sce)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reducedDim</span>(traj_milo, <span class="st">"PCA"</span>) <span class="ot">&lt;-</span> <span class="fu">reducedDim</span>(sce, <span class="st">"PCA"</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Defining representative neighbourhoods</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  traj_milo <span class="ot">&lt;-</span> <span class="fu">buildGraph</span>(traj_milo, <span class="at">d =</span> <span class="dv">9</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  traj_milo <span class="ot">&lt;-</span> <span class="fu">makeNhoods</span>(traj_milo, <span class="at">d =</span> <span class="dv">9</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Counting cells in neighbourhoods</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  traj_milo <span class="ot">&lt;-</span> <span class="fu">countCells</span>(traj_milo, <span class="at">meta.data =</span> <span class="fu">colData</span>(traj_milo), <span class="at">sample=</span><span class="st">"sample_id"</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  traj_milo <span class="ot">&lt;-</span> <span class="fu">calcNhoodDistance</span>(traj_milo, <span class="at">d=</span><span class="dv">9</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DA testing</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  traj_design <span class="ot">&lt;-</span> <span class="fu">prepare.traj_design</span>(traj_milo)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  milo.da_res <span class="ot">&lt;-</span> <span class="fu">testNhoods</span>(traj_milo, <span class="at">design =</span> <span class="sc">~</span> condition, <span class="at">design.df =</span> traj_design)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  milo.da_res <span class="ot">&lt;-</span> <span class="fu">groupNhoods</span>(traj_milo, <span class="at">da.res =</span>  milo.da_res)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Annotate cell type to each neighbourhood</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colData</span>(traj_milo)<span class="sc">$</span>merging1 <span class="ot">&lt;-</span> <span class="fu">cluster_ids</span>(sce, cluster_id)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  milo.da_res <span class="ot">&lt;-</span> <span class="fu">annotateNhoods</span>(traj_milo, <span class="at">da.res =</span> milo.da_res, <span class="at">coldata_col =</span> cluster_id)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>milo.da_res <span class="ot">&lt;-</span> <span class="fu">run.Milo</span>(sce.list[[<span class="dv">1</span>]], <span class="st">"merging1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Constructing kNN graph with k:10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Checking valid object</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Running refined sampling with reduced_dim</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .refined_sampling(random_vertices, X_reduced_dims, k): Rownames not
set on reducedDims - setting to row indices</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Checking meta.data validity</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Counting cells in neighbourhoods</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>as(&lt;dgTMatrix&gt;, "dgCMatrix") is deprecated since Matrix 1.5-0; do as(., "CsparseMatrix") instead</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using TMM normalisation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing spatial FDR correction withk-distance weighting</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Found 7418 DA neighbourhoods at FDR 10%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asMethod(object): sparse-&gt;dense coercion: allocating vector of size
1.9 GiB</code></pre>
</div>
</div>
<p>Comparison by logFC</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-9_3fac973d1c45b2ac54324327305fd703">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot.logFC <span class="ot">&lt;-</span> <span class="cf">function</span>(milo.da_res, diffcyt.da_res){</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  milo.da_res<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="st">"grey"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  milo.da_res[milo.da_res<span class="sc">$</span>logFC <span class="sc">&gt;</span> <span class="dv">1</span>, ]<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="st">"#F76D5E"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  milo.da_res[milo.da_res<span class="sc">$</span>logFC <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span>, ]<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="st">"#3FA0FF"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  diffcyt.da_res<span class="sc">$</span>merging1 <span class="ot">&lt;-</span> diffcyt.da_res<span class="sc">$</span>cluster_id</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(milo.da_res, <span class="fu">aes</span>(<span class="at">x=</span>merging1, <span class="at">y =</span> logFC, <span class="at">color=</span>milo.da_res<span class="sc">$</span>color)) <span class="sc">+</span> <span class="fu">geom_quasirandom</span>(<span class="at">alpha=</span>.<span class="dv">3</span>,<span class="at">varwidth=</span><span class="cn">TRUE</span>) <span class="sc">+</span>  <span class="fu">stat_summary</span>(<span class="at">fun.y=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>, <span class="at">shape=</span><span class="dv">8</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(diffcyt.da_res), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>merging1, <span class="at">y=</span>logFC), <span class="at">pch=</span><span class="dv">16</span>, <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">scale_colour_identity</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">1</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span> <span class="sc">-</span><span class="dv">1</span>,<span class="at">linetype=</span><span class="dv">2</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#+ geom_point(data=data.frame(diffcyt.da_res), mapping = aes(x=merging1, y=logFC))</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot.logFC</span>(milo.da_res, <span class="fu">rowData</span>(diffcyt.da_res[[<span class="dv">1</span>]]<span class="sc">$</span>res))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.
ℹ Please use the `fun` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03_comparsion_milo_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comparison by P-value</p>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-10_a20959a8d8b4c0d8fea5fae6d48aa810">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plot.PValue <span class="ot">&lt;-</span> <span class="cf">function</span>(milo.da_res, diffcyt.da_res){</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  diffcyt.da_res<span class="sc">$</span>merging1 <span class="ot">&lt;-</span> diffcyt.da_res<span class="sc">$</span>cluster_id</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  diffcyt.da_res<span class="sc">$</span>PValue <span class="ot">&lt;-</span> diffcyt.da_res<span class="sc">$</span>p_val</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(milo.da_res, <span class="fu">aes</span>(<span class="at">x=</span>merging1, <span class="at">y=</span>PValue, <span class="at">color=</span>merging1)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">fun.y=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>, <span class="at">shape=</span><span class="dv">23</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(diffcyt.da_res), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>merging1, <span class="at">y=</span>PValue))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot.PValue</span>(milo.da_res, <span class="fu">rowData</span>(diffcyt.da_res[[<span class="dv">1</span>]]<span class="sc">$</span>res))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 882 rows containing missing values (`geom_violin()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="03_comparsion_milo_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-11_46901718980dfa6f5a4bcc5937dcc390">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(milo.da_res, <span class="fu">aes</span>(<span class="at">x=</span>NhoodGroup,<span class="at">fill =</span>  <span class="fu">factor</span>(merging1))) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03_comparsion_milo_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="03_comparsion_milo_cache/html/unnamed-chunk-12_167b40987c1216227a321046ae766952">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cell_counts_per_sample &lt;- assay(da_res2$res, "counts")</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plotExprHeatmap(sce, k="merging1", by="cluster_id")</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plotAbundances(sce, k = "merging1", by = "cluster_id", shape_by = "sample_id")</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#cd &lt;- data.frame(colData(sce), t(assay(sce,"exprs")), k = cluster_ids(sce, "merging1"))</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#avg_exprs_sample_cell &lt;- by(cd, list(cd$sample_id, cd$k), \(df) {</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  fd &lt;- df[, colnames(df) %in% rownames(sce)]</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  pbs &lt;- colMeans(as.matrix(fd))</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  data.frame(sample_id = df$sample_id[1], cluster_id = df$k[1], pbs)</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#})</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>